

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Upgrade a normal install to a Docker install &mdash; elabftw 1.2.5 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="elabftw 1.2.5 documentation" href="index.html"/>
        <link rel="next" title="Thanks" href="thanks.html"/>
        <link rel="prev" title="Contributing" href="contributing.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> elabftw
          

          
          </a>

          
            
            
              <div class="version">
                1.2.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Installing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install-gnulinux.html">Install on GNU/Linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-drop.html">Install in the cloud</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-docker.html">Install in a Docker container</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-mac.html">Install on Mac OS X</a></li>
<li class="toctree-l1"><a class="reference internal" href="install-windows.html">Install on Windows (in Docker)</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-errors.html">Common errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="postinstall.html">Post install</a></li>
<li class="toctree-l1"><a class="reference internal" href="backup.html">How to backup</a></li>
<li class="toctree-l1"><a class="reference internal" href="how-to-update.html">How to update</a></li>
</ul>
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="manual.html">Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Upgrade a normal install to a Docker install</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparation">Preparation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-docker">Install Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-docker-compose">Install Docker-compose</a></li>
<li class="toctree-l3"><a class="reference internal" href="#export-current-install">Export current install</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-the-config-file">Get the config file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#fill-the-config-file">Fill the config file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#about-https-ssl-tls">About HTTPS (SSL/TLS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-the-containers">Starting the containers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="thanks.html">Thanks</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">elabftw</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Upgrade a normal install to a Docker install</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/upgrade-to-docker.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="upgrade-a-normal-install-to-a-docker-install">
<span id="upgrade-to-docker"></span><h1>Upgrade a normal install to a Docker install<a class="headerlink" href="#upgrade-a-normal-install-to-a-docker-install" title="Permalink to this headline">¶</a></h1>
<img alt="docker" class="align-center" src="_images/docker.png" />
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This guide is aimed at (GNU/Linux) users who have installed eLabFTW the old school way (git clone or zip archive) and want to benefit from Docker.
If you are not familiar with Docker, take the time to read the documentation on the Docker website. And read also the <a class="reference internal" href="install-docker.html#docker-doc"><span>in-depth documentation for eLabFTW with Docker</span></a>.</p>
</div>
<div class="section" id="preparation">
<h2>Preparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-docker">
<h3>Install Docker<a class="headerlink" href="#install-docker" title="Permalink to this headline">¶</a></h3>
<p>We will obviously need to <a class="reference external" href="https://docs.docker.com/engine/installation/linux/">install Docker</a>.</p>
<p>Once this is done try a:</p>
<div class="highlight-bash"><div class="highlight"><pre>docker run hello-world
</pre></div>
</div>
<p>If everything works, you should see a little message explaining what Docker did to print this message.</p>
</div>
<div class="section" id="install-docker-compose">
<h3>Install Docker-compose<a class="headerlink" href="#install-docker-compose" title="Permalink to this headline">¶</a></h3>
<p>We need <cite>docker-compose</cite> to orchestrate our containers. <a class="reference external" href="https://docs.docker.com/compose/install/">Install docker-compose</a>.</p>
</div>
<div class="section" id="export-current-install">
<h3>Export current install<a class="headerlink" href="#export-current-install" title="Permalink to this headline">¶</a></h3>
<p>Before going further, make sure you have backups of the existing installation. Read how to backup <a class="reference internal" href="backup.html#backup"><span>here</span></a>.</p>
<p>You should have a <cite>dump.sql</cite> file of the elabftw database. And your <cite>uploads</cite> folder is copied somewhere safe.</p>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="get-the-config-file">
<h3>Get the config file<a class="headerlink" href="#get-the-config-file" title="Permalink to this headline">¶</a></h3>
<p>The <cite>docker-compose.yml</cite> file is our only configuration file for Docker. Get it:</p>
<div class="highlight-bash"><div class="highlight"><pre>wget https://raw.githubusercontent.com/elabftw/docker-elabftw/master/src/docker-compose.yml-EXAMPLE -O docker-compose.yml
</pre></div>
</div>
<p>Edit it with your favorite text editor:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$EDITOR</span> docker-compose.yml
</pre></div>
</div>
</div>
<div class="section" id="fill-the-config-file">
<h3>Fill the config file<a class="headerlink" href="#fill-the-config-file" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the value of DB_PASSWORD to a new generated long password. You can get one <a class="reference external" href="https://www.grc.com/passwords.htm">here</a></li>
<li>Open the <cite>config.php</cite> file located in your <cite>elabftw</cite> folder of the current install</li>
<li>Copy the SECRET_KEY value from the <cite>config.php</cite> file to the <cite>docker-compose.yml</cite> file</li>
<li>Change the SERVER_NAME to the name of your server (elabftw.example.edu or the IP address)</li>
<li>Port: change &#8220;443:443&#8221; to &#8220;8080:443&#8221; or &#8220;444:443&#8221; or &#8220;9000:443&#8221; because Apache is already using port 443.</li>
<li>Volumes: copy the <cite>uploads</cite> folder to <cite>/dok/</cite> or wherever you want it</li>
<li>Change the MYSQL_ROOT_PASSWORD to something complicated</li>
<li>Change the MYSQL_PASSWORD to the same value as DB_PASSWORD</li>
<li>You can optionally edit where the MySQL database will be stored persistently</li>
<li>If you are running MySQL&nbsp;5.5 or 5.6, edit the 5.7 in the <cite>image: mysql:5.7</cite> line to the appropriate version. You can upgrade later.</li>
</ul>
</div>
<div class="section" id="about-https-ssl-tls">
<h3>About HTTPS (SSL/TLS)<a class="headerlink" href="#about-https-ssl-tls" title="Permalink to this headline">¶</a></h3>
<p>As you know, eLabFTW can only run with HTTPS. So if you were running it before, there are good chances that you already have a&nbsp;certificate. If it&#8217;s a self-signed one, nothing needs to be done. The Docker image will generate a new certificate when the container is created. But your users will get a warning when they access the website, which is not ideal.</p>
<p>One solution to this is to request a certificate from <a class="reference external" href="https://letsencrypt.org">Let&#8217;s Encrypt</a>. It&#8217;s free and you get a real proper certificate. See the documentation on Let&#8217;s Encrypt website on how to request a certificate for your website. You will need to have a domain name (it doesn&#8217;t work if you just have an IP address or if the server is not accessible from outside a company&#8217;s network) pointing to the server.</p>
<p>Another solution is to use the certificate you already have.</p>
<ul class="simple">
<li>Change the value of ENABLE_LETSENCRYPT to true.</li>
<li>Uncomment the line <cite>#- /etc/letsencrypt:/ssl</cite> (remove the leading #)</li>
<li>If your domain is <cite>elabftw.example.com</cite>, do this:</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># as root</span>
mkdir -p /etc/letsencrypt/live/elabftw.example.com/
cp /path/to/your/current-cert.pem /etc/letsencrypt/live/elabftw.example.com/fullchain.pem
cp /path/to/your/current-key.pem /etc/letsencrypt/live/elabftw.example.com/privkey.pem
</pre></div>
</div>
<p>Another way to do this is to <cite>git clone</cite> the <cite>docker-elabftw</cite> repo and edit the <cite>src/run.sh</cite> script to point to the correct directory, but this will not be covered in this guide.</p>
</div>
<div class="section" id="starting-the-containers">
<h3>Starting the containers<a class="headerlink" href="#starting-the-containers" title="Permalink to this headline">¶</a></h3>
<p>We now have a complete <cite>docker-compose.yml</cite> config file and we can start <cite>elabftw</cite> with this command:</p>
<div class="highlight-bash"><div class="highlight"><pre>docker-compose up -d
</pre></div>
</div>
<p>This will create an empty database in <cite>/dok/mysql</cite> or wherever you chose to have it. But of course, what we want is to have our old database in there! To do that we will copy our <cite>dump.sql</cite> file to the <cite>mysql</cite> container and import it in place of the freshly created database (which is empty!).</p>
<div class="highlight-bash"><div class="highlight"><pre>docker cp dump.sql mysql:/
docker <span class="nb">exec</span> -it mysql bash
mysql -uroot -p
<span class="c"># here you type the password you put in MYSQL_ROOT_PASSWORD in the docker-compose.yml file</span>
Mysql&gt; drop database elabftw<span class="p">;</span>
Mysql&gt; create database elabftw<span class="p">;</span>
Mysql&gt; use elabftw<span class="p">;</span>
Mysql&gt; <span class="nb">source </span>dump.sql<span class="p">;</span>
Mysql&gt; <span class="nb">exit</span><span class="p">;</span>
</pre></div>
</div>
<p>You should now have your old database running. If you were upgrading from an old version, make sure to read the release note of each version. Specifically the 1.2.1 one where there is a manual step to copy the new SECRET_KEY to the docker-compose.yml.</p>
<p>Test everything is working by clicking everything. Report any problem in the present documentation so it can be improved.</p>
<p>As always, if you need help, open a github issue :)</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="thanks.html" class="btn btn-neutral float-right" title="Thanks" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="contributing.html" class="btn btn-neutral" title="Contributing" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2012, Nicolas CARPi.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.2.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>