/*! elabftw 1.6.1 https://www.elabftw.net */

class Todolist{constructor(controller){this.controller=controller}formatLeadingZero(leadingZeros,number){var temp=""+(Math.pow(10,leadingZeros)+number);return temp.substr(1,temp.length)}getCurrentTimestamp(){var currentdate=new Date;return currentdate.getFullYear()+"-"+this.formatLeadingZero(2,currentdate.getMonth()+1)+"-"+currentdate.getDate()+" "+this.formatLeadingZero(2,currentdate.getHours())+":"+this.formatLeadingZero(2,currentdate.getMinutes())+":"+this.formatLeadingZero(2,currentdate.getSeconds())}create(e){e.preventDefault();var self=this,body=$("#todo").val(),datetime=(new Date,this.getCurrentTimestamp());""!==body&&$.post(this.controller,{create:!0,body:body}).done(function(data){var json=JSON.parse(data);json.res?($("#todoItems-list").prepend("<li class='ui-sortable-handle' id='todoItem_"+json.id+"'><a href='#' class='destroyTodoItem' data-id='"+json.id+"'>X</a><span style='font-size:60%;display:block;'>"+datetime+"</span><span id='todoItem_"+json.id+"' class='editable'>"+body+"</li>"),self.makeEditableTodoitem(),$("#todo").val("")):notif(json.msg,"ko")})}destroy(id){$.post(this.controller,{destroy:!0,id:id}).done(function(data){var json=JSON.parse(data);json.res?($("#todoItem_"+id).css("background","#29AEB9"),$("#todoItem_"+id).toggle("blind")):notif(json.msg,"ko")})}destroyAll(){$.post(this.controller,{destroyAll:!0}).done(function(data){var json=JSON.parse(data);json.res?$("#todoItems-list").children().toggle("blind"):notif(json.msg,"ko")})}toggle(){"none"===$("#todoList").css("display")?$("#todoList").css("display","inline"):$("#todoList").css("display","none")}makeEditableTodoitem(){var self=this;$(".editable").editable(function(value,settings){return $.post(self.controller,{update:!0,body:value,id:$(this).attr("id")}).done(function(data){var json=JSON.parse(data);json.res?notif(json.msg,"ok"):notif(json.msg,"ko")}),value},{tooltip:"Click to edit",indicator:"Saving...",name:"fileComment",submit:"Save",cancel:"Cancel",style:"display:inline"})}}var tl=new Todolist("app/controllers/TodolistController.php");$("#todo-form").submit(function(e){tl.create(e)}),$(document).on("click",".todoToggle",function(){tl.toggle()}),$(document).on("click",".todoDestroyAll",function(){tl.destroyAll()}),$(document).on("click",".destroyTodoItem",function(){tl.destroy($(this).data("id"))}),$("#todoItems-list").on("mouseover",".editable",function(){tl.makeEditableTodoitem()}),key($("#todoSc").data("toggle"),function(){tl.toggle()}),$("#todoItems-list").sortable({axis:"y",helper:"clone",update:function(event,ui){var ordering=$("#todoItems-list").sortable("toArray");$.post(tl.controller,{updateOrdering:!0,ordering:ordering}).done(function(data){var json=JSON.parse(data);json.res?notif(json.msg,"ok"):notif(json.msg,"ko")})}});