/*! elabftw 1.6.1 https://www.elabftw.net */

var self;class ExperimentSteps extends Todolist{constructor(){super("app/controllers/ExperimentStepsController.php"),this.experimentId=null,self=this}open(experimentId){this.experimentId=experimentId,console.log("Opening ExperimentSteps for experiment "+experimentId),$.post(self.controller,{read:!0,experimentid:self.experimentId}).done(function(data){console.log("read operation returned: "+data);var json=JSON.parse(data);if($("#experimentStep-list").html(""),json.res&&null!=json.todoItems)for(var i=0;i<json.todoItems.length;i++){var experimentStep=json.todoItems[i];$("#experimentStep-list").append("<li class='todoItem' id='experimentStep_"+experimentStep.id+"'><a href='#' class='experimentStepDestroyTodoItem' data-id='"+experimentStep.id+"'>X</a><span style='font-size:60%;display:block;'>"+experimentStep.creation_time+"</span><span id='experimentStep_"+experimentStep.id+"' class='editable'>"+experimentStep.body+"</li>")}else notif(json.msg,"ko");self.show()})}create(e){e.preventDefault();var self=this,body=$("#es-todo").val(),datetime=this.getCurrentTimestamp();""!==body&&(console.log("Calling "+self.controller+" with body='"+body+"' and experimentid='"+self.experimentId+"'"),$.post(self.controller,{create:!0,body:body,experimentid:self.experimentId}).done(function(data){var json=JSON.parse(data);console.log(data),json.res?($("#experimentStep-list").prepend("<li class='todoItem' id='experimentStep_"+json.id+"'><a href='#' class='experimentStepDestroyTodoItem' data-id='"+json.id+"'>X</a><span style='font-size:60%;display:block;'>"+datetime+"</span><span id='experimentStep_"+json.id+"' class='editable'>"+body+"</li>"),self.makeEditableTodoitem(),$("#es-todo").val("")):notif(json.msg,"ko")}))}destroy(id){$.post(this.controller,{destroy:!0,id:id}).done(function(data){var json=JSON.parse(data);json.res?($("#experimentStep_"+id).css("background","#29AEB9"),$("#experimentStep_"+id).toggle("blind")):notif(json.msg,"ko")})}toggle(){"none"===$("#experimentSteps").css("display")?$("#experimentSteps").css("display","inline"):$("#experimentSteps").css("display","none")}show(){"none"===$("#experimentSteps").css("display")&&$("#experimentSteps").css("display","inline")}hide(){"none"!==$("#experimentSteps").css("display")&&$("#experimentSteps").css("display","none")}destroyAll(){$.post(this.controller,{destroyAll:!0,experimentid:self.experimentId}).done(function(data){var json=JSON.parse(data);json.res?$("#experimentStep-list").children().toggle("blind"):notif(json.msg,"ko")})}}var es=new ExperimentSteps;$("#es-form").submit(function(e){es.create(e)}),$(document).on("click",".todoHide",function(){es.hide()}),$(document).on("click",".experimentStepsDestroyAll",function(){es.destroyAll()}),$(document).on("click",".experimentStepDestroyTodoItem",function(){es.destroy($(this).data("id"))}),$("#experimentStep-list").on("mouseover",".editable",function(){es.makeEditableTodoitem()}),$(document).on("click",".experimentstepicon",function(){es.toggle()}),$("#experimentStep-list").sortable({axis:"y",helper:"clone",update:function(event,ui){var ordering=$("#experimentStep-list").sortable("toArray");$.post(es.controller,{experimentid:es.experimentId,updateOrdering:!0,ordering:ordering}).done(function(data){var json=JSON.parse(data);json.res?notif(json.msg,"ok"):notif(json.msg,"ko")})}});