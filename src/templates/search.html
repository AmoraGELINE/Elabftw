{% include 'head.html' %}

<!-- Modal for advanced search -->
<div class='modal fade' id='advancedSearchModal' tabindex='-1' role='dialog' aria-labelledby='advancedSearchModalLabel' aria-hidden='true'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title' id='advancedSearchModalLabel'>{{ 'Search Query Language'|trans }}</h5>
        <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
          <span aria-hidden='true'>&times;</span>
        </button>
      </div>
      <div class='modal-body' data-wait='{{ 'Please waitâ€¦' }}'>
        <h3>Search terms</h3>
        <p>The search is performed against the title and the body.</p>
        <dl>
          <dt>Simple term</dt>
          <dd>A sequence of characters without {whitespace}.<br>
              <em>termA</em> or <em>termB</em> or <em>456</em>
          </dd>
          
          <dt>Quoted term</dt>
          <dd>A sequence of characters including {whitespace} enclosed in single (') or double (") quotation marks.<br>
              <em>'Hello world'</em> or <em>"I love eLabFTW!"</em>
          </dd>
        </dl>
        <h3>Term concatenation and grouping</h3>
        <p>Terms can be connected in different ways:</p>
        <ul>
          <li>"OR" or "|", <em>termA OR termB</em> or <em>termA |termB</em></li>
          <li>"AND", "&" or {whitespace}, <em>termA termB</em> or <em>termA AND termB</em> or <em>termA &termB</em></li>
          <li>"NOT" or "!", <em>!termA</em> or <em>NOT termA</em></li>
          <li>Parenthesis (), <em>(termA OR termB) AND !termC</em></li>
        </ul>
        <p>The operators are listed in increasing priority. <em>termA termB OR termC</em> is equivalent to <em>(termA AND termB) OR termC</em></p>
        <h3>Field/value pair searches</h3>
        <p>Base syntax <code>[field]:[value]</code></p>
        <dl>
          <dt>attachment</dt>
          <dd>yes or no, true or false, 1 or 0, on or off</dd>
          <dt>author</dt>
          <dd>Simple term or Quoted term</dd>
          <dt>body</dt>
          <dd>Simple term or Quoted term</dd>
          <dt>category</dt>
          <dd>Simple term or Quoted term; Only if Database is selected.</dd>
          <dt>date</dt>
          <dd><a href='#dateFormats'>See accepted date formats below</a></dd>
          <dt>elabid</dt>
          <dd>Simple term or Quoted term</dd>
          <dt>locked</dt>
          <dd>yes or no, true or false, 1 or 0, on or off</dd>
          <dt>rating</dt>
          <dd>0, 1, 2, 3, 4, 5 or unrated</dd>
          <dt>status</dt>
          <dd>Simple term or Quoted term; Only if Experiment is selected.</dd>
          <dt>timestamped</dt>
          <dd>yes or no, true or false, 1 or 0, on or off</dd>
          <dt>title</dt>
          <dd>Simple term or Quoted term</dd>
          <dt>visibility</dt>
          <dd>Simple term or Quoted term<br>A group name (e.g. 'My Group'), public, organization, team, 'me and admins', or 'only me'.</dd>
        </dl>
        <h3 id='dateFormats'>Date formats</h3>
        <p>A date has to be provided in the following format: YYYYMMDD i.e, four digit year, two digit month and two digit day. Year, month and day can, but don't have to, be separated by a hyphen (-), slash (/), period (.), or comma (,).<br>
          Either a single date or a date range can be used.</p>
        <p>Single date: {operator}date<br>
          operators: &lt;, &lt;=, =, &gt;=, &gt;, !=<br>
          An operator are optional. default is =<br>
          e.g., date:20210504 or date:>2012-04-17 or date:>=2020.09.01
        </p>
        <p>Date range: date..date<br>
          Two dates separated by two periods (..)<br>
          e.g., date:20200101..20201231
        </p>
      </div>
      <div class='modal-footer'>
        <button type='button' class='btn btn-secondary' data-dismiss='modal'>{{ 'Close'|trans }}</button>
      </div>
    </div>
  </div>
</div>


<!-- SEARCH PAGE BEGIN -->
<form name="search" method="get" action="search.php">
  <section class='searchform box'>
    <div class='row'>
      <!-- SEARCH IN-->
      <div class='col-md-3'>
        <label for='searchin'>{{ 'Search in'|trans }}</label>
        <select name='type' id='searchin' class='form-control'>
          <option value='experiments'>{% trans %}Experiment {% plural 2 %}Experiments{% endtrans %}</option>
          <option disabled>----------------</option>
          <option value='database'{{ Request.query.get('type') == 'database' ? ' selected' }}>{{ 'Database'|trans }}</option>
          {% for category in itemsTypesArr %}
            <option value='{{ category.category_id }}'{{ Request.query.get('type') == category.category_id ? ' selected' }}>
              {{ category.category }}
            </option>
          {% endfor %}
        </select>
      </div>
      <!-- END SEARCH IN -->

      <!-- SEARCH WITH TAG -->
      <div class='col-md-6'>
        <label for='tags-select'>{{ 'With the tag'|trans }}</label>
        <select multiple name='tags[]' id='tags-select' class='form-control selectpicker' data-show-subtext='true' data-live-search='true' data-showtick='true' data-actions-box='true'>
          {% for tag in tagsArr %}
            <option value='{{ tag.tag }}'{{ tag.tag in App.Request.query.get('tags') ? ' selected' }}>{{ tag.tag|raw }}</option>
          {% endfor %}
        </select>
      </div>
      <!-- END SEARCH WITH TAG -->

      <!-- VISIBILITY SEARCH -->
      <div class='col-md-3'>
        <label for='visibility'>{{ 'And visibility is:'|trans }} </label><br>
        <select id='visibility' name='vis' class='form-control'>
          <option value=''>{{ 'Select visibility'|trans }}</option>
          {% for key, value in visibilityArr %}
            <option value='{{ key }}' {{ Request.query.get('vis') == key ? " selected='selected'" }}>{{ value|trans }}</option>
          {% endfor %}
        </select>
      </div>
      <br>
      <!-- END VISIBILITY SEARCH -->

      <!-- SEARCH ONLY -->
      <div class='col-md-6'>
        <label for='searchonly'>{{ 'Search only in experiments owned by:'|trans }} </label><br>
        <select id='searchonly' name='owner' class='form-control mb-3'>
          <option value=''>{{ 'Yourself'|trans }}</option>
          <!-- add an option to search in the whole team (owner = 0) -->
          <option value='0'{{ Request.query.get('owner') == '0' ? ' selected' }}>{{ 'All the team'|trans }}</option>
          <option disabled>----------------</option>
          {% for user in usersArr %}
            <option value='{{ user.userid }}'{{ Request.query.get('owner') == user.userid ? ' selected' }}>
              {{ user.fullname|raw }}
            </option>
          {% endfor %}
        </select>
      </div>
      <br>
      <!-- END SEARCH ONLY -->

    </div>
    <!-- NEW ROW -->
    <div class='row'>

      <!-- SEARCH DATE -->
      <div class='col-md-8'>
        <label for='from'>{{ 'Where date is between'|trans }}</label>
        <input id='from' name='from' type='date' class='formcontrol' value='{{ Request.query.get('from') != '' ? Request.query.get('from') }}'/>
        <label class='ml-2' for='to'>{{ 'and'|trans }}</label>
        <input id='to' name='to' type='date' class='formcontrol' value='{{ Request.query.get('to') != '' ? Request.query.get('to') }}'/>
      </div>
      <!-- END SEARCH DATE -->

    </div>
    <!-- NEW ROW -->
    <div class='row'>

      <div class='col-md-6'>
        <!-- TITLE -->
        <div>
          <label for='title'>{{ 'And title contains'|trans }}</label>
          <input id='title' class='form-control {{- titleError ? ' is-invalid' }}' name='title' type='text' placeholder='term1 termA AND termB !(termC OR "exact term")' value='{{ title }}' {{- titleError ? " aria-describedby='titleFeedback'" }} />
          {% if titleError %}
            <div id='titleFeedback' class='invalid-feedback'>{{ titleError|raw }}</div>
          {% endif %}
        </div>
        <!-- END TITLE -->
        <!-- BODY -->
        <div>
          <label for='body'>{{ 'And body contains'|trans }}</label>
          <input id='body' class='form-control {{- bodyError ? ' is-invalid' }}' name='body' type='text' placeholder='term1 termA AND termB !(termC OR "exact term")' value='{{ body }}' {{- bodyError ? " aria-describedby='bodyFeedback'" }} />
          {% if bodyError %}
            <div id='bodyFeedback' class='invalid-feedback'>{{ bodyError|raw }}</div>
          {% endif %}
          <small class='form-text text-muted'>
            <a class='' data-action='toggle-modal' data-target='advancedSearchModal'>{{ 'Advanced search is supported'|trans }}</a>
          </small>
        </div>
        <!-- END BODY -->
      </div>

      <div class='col-md-4'>
        <!-- STATUS -->
        <div>
          <label for='status'>{{ 'And status is'|trans }}</label>
          <select id='status' name='status' class='form-control'>
            <option value=''>{{ 'Select status'|trans }}</option>
            {% for status in statusArr %}
              <option value='{{ status.category_id }}'{{ Request.query.get('status') == status.category_id ? ' selected' }}>
                {{ status.category }}
              </option>
            {% endfor %}
          </select>
        </div>
        <!-- END STATUS -->
        <!-- RATING -->
        <div>
          <label for='rating'>{{ 'And rating is'|trans }}</label>
          <select id='rating' name='rating' class='form-control'>
            <option value=''>{{ 'Select number of stars'|trans }}</option>
            <option value='null'{{ Request.query.get('rating') == 'null' ? ' selected' }}>{{ 'Unrated'|trans }}</option>
            {% for i in range(1, 5) %}
              <option value='{{ i }}'{{ Request.query.get('rating') == i ? ' selected' }}>{{ i }}</option>
            {% endfor %}
          </select>
        </div>
        <!-- END RATING -->
      </div>
    </div>
    <!-- NEW ROW -->
    <div class='row'>
      <div class='col-md-6'>
        <pre>{{ whereClause|raw }}</pre>
      </div>
    </div>
    <!-- NEW ROW -->
    <div class='row'>
      <h4 class='ml-3'>{{ 'Extra fields search'|trans }}</h4>
    </div>

    <div class='row'>
      <div class='col-md-4'>
        <label for='metakey'>{{ 'Name of field'|trans }}</label>
        <input type='text' class='form-control' name='metakey' value='{{ Request.query.get('metakey') != '' ? Request.query.get('metakey') }}' />
      </div>

      <div class='col-md-4'>
        <label for='metavalue'>{{ 'Value'|trans }}</label>
        <input type='text' class='form-control' name='metavalue' value='{{ Request.query.get('metavalue') != '' ? Request.query.get('metavalue') }}' />
        <p>{{ "Tip: you can use '%' as wildcard"|trans }}</p>
      </div>
    </div>

    <div style='margin:30px;' class='text-center'>
      <button id='searchButton' class='button btn btn-primary' value='Submit' type='submit'>
        {{ 'Launch search'|trans }}
      </button>
      <a href='search.php' class='button btn btn-danger'>
        {{ 'Clear all'|trans }}
      </a>
    </div>
  </section>
<!-- if there is no query, end the form here, otherwise let it open so the filter/order/sort menu can be part of it
  it avoids having to repeat the query params -->
{{ not App.Request.query.has('type') ? '</form>' }}
<a href='#' id='anchor'></a>
<div id='shortcuts' data-create='{{ App.Users.userData.sc_create }}'></div>
