{% extends 'base.html' %}

{% block body %}
<!-- show message if there is a failed_attempt -->
{% if App.Session.has('failed_attempt') and App.Session.get('failed_attempt') < App.Config.configArr.login_tries %}
    {% set number_of_tries_left = App.Config.configArr.login_tries - App.Session.get('failed_attempt') %}
    {{ 'Number of login attempt left before being banned for %s minutes: %s'|trans|format(
        App.Config.configArr.ban_time,
        number_of_tries_left)|msg('ko') }}
{% endif %}

<section class='text-center'>
  <img src='app/img/logo.png' alt='elabftw' title='elabftw' class='col-md-3' />
  <form method='post' action='app/controllers/MfaController.php' autocomplete='off'>
    <!-- form key -->
    {{ App.Csrf.getHiddenInput|raw }}
    {% if App.Session.has('enable_mfa') %}
      <h4>{{ 'Two Factor Authentication'|trans }}</h4>
      <p>{{ 'Open your authenticator application and scan the QR code.'|trans }}</p>
      <p><img src='{{ mfaQRCodeImageDataUri|raw }}'></p>

      <div class='text-center col-md-5 mx-auto'>
        <label for='mfa_secret'>{{ 'Secret for manual setup'|trans }}</label>
        <div class='input-group'>
          <input class='form-control text-center' value='{{ mfaSecret|raw }}' id='mfa_secret' name='mfa_secret' type='password' readonly='readonly' />
          <div class='input-group-append'>
            <span class='btn btn-light input-border togglePassword' tabindex='-1' toggle='#mfa_secret'><i class='fas fa-eye' aria-hidden='true'></i></span>
          </div>
        </div>
      </div>
    {% endif %}
    <div class='col-md-4 mx-auto mt-4 form-group'>
      <label for='mfa_code'>{{ 'Authentication code'|trans }}</label>
      <input class='form-control mb-4 text-center' id='mfa_code' name='mfa_code' type='text' required='required' pattern='.{6}' aria-describedby='mfa_code_help_block' />
      <p id='mfa_code_help_block' class='form-text text-muted'>{{ 'Open the authenticator app on your device to get your authentication code and verify your identity.'|trans }}</p>
    </div>
    <button type='submit' class='button btn btn-primary' name='Submit'>{{ 'Verify'|trans }}</button>
  </form>
</section>
{% endblock body %}
